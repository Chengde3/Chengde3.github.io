---
layout: post
title: C++内存分配方式
date: 2015-08-10
categories: C++
tags: c++ memory
---

## 1. 内存分配方式

有三种内存分配方式：

- **从静态存储区域分配**：内存在程序编译的时候就已经分配好，这块内存在程序的整个运行期间都存在。例如**全局变量和static变量**；
- **在栈上创建**：在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。栈内存分配运算效率高，但是分配的容量有限；一般存储**局部变量/函数参数/返回数据/返回地址等**；
- **从堆上分配**：亦称动态内存分配。程序在运行时用malloc或new申请任意多少的内存，程序员自己负责在何时使用free或delete释放内存。动态内存的生存区由程序员决定，使用非常灵活。但是如果在堆上分配了空间，就有责任回收它，否则运行的程序会出现内存泄露，频繁地分配和释放不同大小的堆空间将会产出堆内碎块。 


## 2. 堆栈的区别

- **申请方式**：栈由系统分配释放，堆由程序员自己申请释放；
- **申请大小**：栈是向低地址扩展的数据结构，是一块连续的内存区域，堆时向高地址扩展的数据结构，是不连续的内存区域（链表）；
- **申请效率**：栈由系统分配，速度快；堆是由程序员分配，速度慢，且容易产生内存碎片；

## 3. 参考文献

- [C/C++ 内存分配方式，堆区，栈区，new/delete/malloc/free](http://blog.csdn.net/rujielaisusan/article/details/4622197)
- [C++内存分配方式详解——堆、栈、自由存储区、全局/静态存储区和常量存储区](http://www.cnblogs.com/daocaoren/archive/2011/06/29/2092957.html)
- [C/C++内存分配–浅析堆栈](http://songjians.cn/2014/649.html)